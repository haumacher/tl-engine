/*! uml-js - uml-viewer v1.0.0 | Copyright (c) 2019 Business Operation Systems GmbH. All Rights Reserved */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.UmlJS=e()}(this,function(){"use strict";var r=[].indexOf,i=function(t,e){if(r)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1},e=/\s+/,o=Object.prototype.toString;function n(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}n.prototype.add=function(t){if(this.list)return this.list.add(t),this;var e=this.array();return~i(e,t)||e.push(t),this.el.className=e.join(" "),this},n.prototype.remove=function(t){if("[object RegExp]"==o.call(t))return this.removeMatching(t);if(this.list)return this.list.remove(t),this;var e=this.array(),n=i(e,t);return~n&&e.splice(n,1),this.el.className=e.join(" "),this},n.prototype.removeMatching=function(t){for(var e=this.array(),n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},n.prototype.toggle=function(t,e){return this.list?void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t):void 0!==e?e?this.add(t):this.remove(t):this.has(t)?this.remove(t):this.add(t),this},n.prototype.array=function(){var t=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(e);return""===t[0]&&t.shift(),t},n.prototype.has=n.prototype.contains=function(t){return this.list?this.list.contains(t):!!~i(this.array(),t)};var t=Element.prototype,a=t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector,s=function(t,e){if(a)return a.call(t,e);for(var n=t.parentNode.querySelectorAll(e),r=0;r<n.length;++r)if(n[r]==t)return!0;return!1};var c,h=function(t,e,n){for(var r=n?t:t.parentNode;r&&r!==document;){if(s(r,e))return r;r=r.parentNode}},u=window.addEventListener?"addEventListener":"attachEvent",l=window.removeEventListener?"removeEventListener":"detachEvent",f="addEventListener"!==u?"on":"",p={bind:function(t,e,n,r){return t[u](f+e,n,r||!1),n},unbind:function(t,e,n,r){return t[l](f+e,n,r||!1),n}},d=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var r=n[1];if("body"==r){var i=e.createElement("html");return i.innerHTML=t,i.removeChild(i.lastChild)}var o=v[r]||v._default,a=o[0],s=o[1],c=o[2];(i=e.createElement("div")).innerHTML=s+t+c;for(;a--;)i=i.lastChild;if(i.firstChild==i.lastChild)return i.removeChild(i.firstChild);var h=e.createDocumentFragment();for(;i.firstChild;)h.appendChild(i.removeChild(i.firstChild));return h},y=!1;"undefined"!=typeof document&&((c=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',y=!c.getElementsByTagName("link").length,c=void 0);var v={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:y?[1,"X<div>","</div>"]:[0,"",""]};v.td=v.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],v.option=v.optgroup=[1,'<select multiple="multiple">',"</select>"],v.thead=v.tbody=v.colgroup=v.caption=v.tfoot=[1,"<table>","</table>"],v.polyline=v.ellipse=v.polygon=v.circle=v.text=v.line=v.path=v.rect=v.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var m="undefined"!=typeof Element?Element.prototype:{};m.matches||m.matchesSelector||m.webkitMatchesSelector||m.mozMatchesSelector||m.msMatchesSelector||m.oMatchesSelector;function g(t,e){return(e=e||document).querySelector(t)}function _(t,e){return{x:t.x-e.x,y:t.y-e.y}}function w(t){return Math.log(t)/Math.log(10)}function b(t,e){var n=w(t.min),r=w(t.max);return(Math.abs(n)+Math.abs(r))/e}var x=Object.prototype.toString,k=Object.prototype.hasOwnProperty;function E(t){return"[object Array]"===x.call(t)}function C(t){return"[object Number]"===x.call(t)}function j(t){return"[object Function]"===x.call(t)}function M(t,e){if(void 0!==t){var n,r,i=E(t)?L:O;for(var o in t){if(n=t,r=o,k.call(n,r))if(!1===e(t[o],i(o)))return}}}function S(t,n,r){return M(t,function(t,e){r=n(r,t,e)}),r}function O(t){return t}function L(t){return Number(t)}function N(t,e){return t.bind(e)}var B=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function R(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return B.apply(void 0,[t].concat(n))}var P=Math.sign||function(t){return 0<=t?1:-1},T={min:.2,max:4};function A(e,t,n){e=e||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=N(this._handleWheel,this),this._totalDelta=0,this._scale=e.scale||.75;var r=this;t.on("canvas.init",function(t){r._init(!1!==e.enabled)})}A.$inject=["config.zoomScroll","eventBus","canvas"],A.prototype.scroll=function(t){this._canvas.scroll(t)},A.prototype.reset=function(){this._canvas.zoom("fit-viewport")},A.prototype.zoom=function(t,e){var n=b(T,20);this._totalDelta+=t,.1<Math.abs(this._totalDelta)&&(this._zoom(t,e,n),this._totalDelta=0)},A.prototype._handleWheel=function(t){if(!h(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,r=t.ctrlKey,i=t.shiftKey,o=-1*this._scale;if(o*=r?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,r){var a=e.getBoundingClientRect(),s={x:t.clientX-a.left,y:t.clientY-a.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*P(t.deltaY)*o,this.zoom(n,s)}else n=i?{dx:o*t.deltaY,dy:0}:{dx:o*t.deltaX,dy:o*t.deltaY},this.scroll(n)}},A.prototype.stepZoom=function(t,e){var n=b(T,10);this._zoom(t,e,n)},A.prototype._zoom=function(t,e,n){var r=this._canvas,i=0<t?1:-1,o=w(r.zoom()),a=Math.round(o/n)*n;a+=n*i;var s,c,h=Math.pow(10,a);r.zoom((s=T,c=h,Math.max(s.min,Math.min(s.max,c))),e)},A.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,r=this._enabled;return void 0===t&&(t=!r),r!==t&&p[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t},A.prototype._init=function(t){this.toggle(t)};var D={__init__:["zoomScroll"],zoomScroll:["type",A]},V=/^djs-cursor-.*$/;function z(t){var e=new n(document.body);e.removeMatching(V),t&&e.add("djs-cursor-"+t)}var G=5e3;function $(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function F(o,a){var s;function e(t){var e,n=s.start,r=$(t),i=_(r,n);(!s.dragging&&(e=i,15<Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)))&&(s.dragging=!0,function(t,e){function n(){return!1}e=e||"element.click",t.once(e,G,n)}(o),z("grab")),s.dragging)&&(i=_(r,s.last||s.start),a.scroll({dx:i.x,dy:i.y}),s.last=r);t.preventDefault()}function n(t){p.unbind(document,"mousemove",e),p.unbind(document,"mouseup",n),z(s=null)}o.on("element.mousedown",500,function(t){return function(t){if(h(t.target,".djs-draggable"))return;if(t.button||t.ctrlKey||t.shiftKey||t.altKey)return;return s={start:$(t)},p.bind(document,"mousemove",e),p.bind(document,"mouseup",n),!0}(t.originalEvent)})}F.$inject=["eventBus","canvas"];var I={__init__:["moveCanvas"],moveCanvas:["type",F]},H=1e3;function Y(t,e){var o=this;e=e||H,t.on(["render.shape","render.connection"],e,function(t,e){var n=t.type,r=e.element,i=e.gfx;if(o.canRender(r))return"render.shape"===n?o.drawShape(i,r):o.drawConnection(i,r)}),t.on(["render.getShapePath","render.getConnectionPath"],e,function(t,e){if(o.canRender(e))return"render.getShapePath"===t.type?o.getShapePath(e):o.getConnectionPath(e)})}function q(t,e){return e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}function W(t,e){return q(e,t),t}Y.prototype.canRender=function(){},Y.prototype.drawShape=function(){},Y.prototype.drawConnection=function(){},Y.prototype.getShapePath=function(){},Y.prototype.getConnectionPath=function(){};var Z=2,X={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":Z,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":Z,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function K(t,e,n){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=X[r];i?(i===Z&&"number"==typeof n&&(n=String(n)+"px"),t.style[r]=n):t.setAttributeNS(null,e,n)}function J(t,e,n){if("string"==typeof e){if(void 0===n)return r=t,X[i=e]?r.style[i]:r.getAttributeNS(null,i);K(t,e,n)}else!function(t,e){var n,r,i=Object.keys(e);for(n=0;r=i[n];n++)K(t,r,e[r])}(t,e);var r,i;return t}function U(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}var Q=/\s+/,tt=Object.prototype.toString;function et(t){return void 0!==t}function nt(t){return new rt(t)}function rt(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function it(t){var e=t.parentNode;return e&&e.removeChild(t),t}rt.prototype.add=function(t){if(this.list)return this.list.add(t),this;var e=this.array();return~U(e,t)||e.push(t),et(this.el.className.baseVal)?this.el.className.baseVal=e.join(" "):this.el.className=e.join(" "),this},rt.prototype.remove=function(t){if("[object RegExp]"===tt.call(t))return this.removeMatching(t);if(this.list)return this.list.remove(t),this;var e=this.array(),n=U(e,t);return~n&&e.splice(n,1),this.el.className.baseVal=e.join(" "),this},rt.prototype.removeMatching=function(t){for(var e=this.array(),n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},rt.prototype.toggle=function(t,e){return this.list?et(e)?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t):et(e)?e?this.add(t):this.remove(t):this.has(t)?this.remove(t):this.add(t),this},rt.prototype.array=function(){var t=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(Q);return""===t[0]&&t.shift(),t},rt.prototype.has=rt.prototype.contains=function(t){return this.list?this.list.contains(t):!!~U(this.array(),t)};var ot={svg:"http://www.w3.org/2000/svg"},at='<svg xmlns="'+ot.svg+'"';function st(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(ot.svg)&&(t=at+t.substring(4)):(t=at+">"+t+"</svg>",e=!0);var n,r,i=(n=t,(r=new DOMParser).async=!1,r.parseFromString(n,"text/xml"));if(!e)return i;for(var o=document.createDocumentFragment(),a=i.firstChild;a.firstChild;)o.appendChild(a.firstChild);return o}function ct(t,e){var n;return n="<"===t.charAt(0)?(n=st(t).firstChild,document.importNode(n,!0)):document.createElementNS(ot.svg,t),e&&J(n,e),n}var ht=ct("svg");function ut(t,e){var n,r,i=Object.keys(e);for(n=0;r=i[n];n++)t[r]=e[r];return t}var lt=/([&<>]{1})/g,ft=/([\n\r"]{1})/g,pt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function dt(t,e){return t.replace(e,function(t,e){return pt[e]||e})}function yt(t,e){var n,r,i,o,a;switch(t.nodeType){case 3:e.push(dt(t.textContent,lt));break;case 1:if(e.push("<",t.tagName),t.hasAttributes())for(n=0,r=(i=t.attributes).length;n<r;++n)o=i.item(n),e.push(" ",o.name,'="',dt(o.value,ft),'"');if(t.hasChildNodes()){for(e.push(">"),n=0,r=(a=t.childNodes).length;n<r;++n)yt(a.item(n),e);e.push("</",t.tagName,">")}else e.push("/>");break;case 8:e.push("\x3c!--",dt(t.nodeValue,lt),"--\x3e");break;case 4:e.push("<![CDATA[",t.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+t.nodeType)}return e}function vt(t,e){var n=st(e);if(function(t){for(var e;e=t.firstChild;)it(e)}(t),e){"#document-fragment"!==n.nodeName&&(n=n.documentElement);for(var r,i=(r=n.childNodes,Array.prototype.slice.call(r)),o=0;o<i.length;o++)q(i[o],t)}}function mt(t,e){if(void 0===e)return function(t){for(var e=t.firstChild,n=[];e;)yt(e,n),e=e.nextSibling;return n.join("")}(t);try{vt(t,e)}catch(t){throw new Error("error parsing SVG: "+t.message)}return t}function gt(t,e){var n=t.transform.baseVal;return e&&(Array.isArray(e)||(e=[e]),function(t,e){var n,r,i,o;for(t.clear(),n=0;r=e[n];n++)t.appendItem((i=t,(o=r)instanceof SVGMatrix?i.createSVGTransformFromMatrix(o):o))}(n,e)),n.consolidate()}function _t(t,e,n){return{x:(1-n)*t.x+n*e.x,y:(1-n)*t.y+n*e.y}}function wt(t){return t.join(",").replace(/,?([A-z]),?/g,"$1")}function bt(t,e,n,r){var i=r.createText(e,n);return nt(i).add("djs-label"),W(t,i),i}function xt(t,e,n,r){var i,o,a,s,c=(i=e,o=n,a=r,s=ct("rect"),J(s,{width:i,height:o}),jt(s,a),s);return W(t,c),c}function kt(t,e,n){var r,i,o=Ct(e),a=Et(Ct(function(t){var e=t.length,n=t.slice();2<=e&&(n[0]=_t(t[0],t[1],.1),n[e-1]=_t(t[e-2],t[e-1],.9));return n}(e)),{stroke:"white","stroke-width":10}),s=Et(o,n),c=(r=[a,s],i=ct("g"),r.forEach(function(t){W(i,t)}),i);return W(t,c),c}function Et(t,e){var n,r,i=ct("path");return J(i,{d:t}),function(t,e){"markerEnd"in e&&J(t,{"marker-end":"url(#"+e.markerEnd+")"});"markerStart"in e&&J(t,{"marker-start":"url(#"+e.markerStart+")"})}(i,e),n=i,"transform"in(r=e)&&J(n,{transform:r.transform}),jt(i,e),i}function Ct(t){for(var e="M "+t[0].x+","+t[0].y+" ",n=1;n<t.length;n++)e+="L "+t[n].x+","+t[n].y+" ";return e}function jt(t,e){"stroke"in e&&J(t,{stroke:e.stroke}),"stroke-width"in e&&J(t,{"stroke-width":e["stroke-width"]}),"fill"in e&&J(t,{fill:e.fill}),"stroke-dasharray"in e&&J(t,{"stroke-dasharray":e["stroke-dasharray"]})}function Mt(n,t,r){t.businessObject;var e,i,o,a,s,c,h,u=xt(n,t.width,t.height,{fill:"none",stroke:"black"}),l=R({dy:".75em"},{x:t.width/2,"text-anchor":"middle"});if(l.y=5,"stereotypes"in t&&t.stereotypes.forEach(function(t){var e=bt(n,"&lt;&lt;"+t+"&gt;&gt;",l,r);l.y+=e.getBBox().height}),"name"in t){var f=bt(n,t.name,l,r);l.y+=f.getBBox().height}return t.labels.some(function(t){return"property"===t.labelType||"classifier"===t.labelType})&&"name"in t&&(e=n,i=t.width,o=l.y,a=e,s={x:0,y:o},c={x:i,y:o},J(h=ct("line"),{x1:s.x,y1:s.y,x2:c.x,y2:c.y,stroke:"black"}),W(a,h)),u}function St(t,e,n){return bt(t,e.businessObject+"",{dy:".75em"},n)}function Ot(t,e){return Tt(t,e,{stroke:"black",markerEnd:"association-marker"})}function Lt(t,e){return Tt(t,e,{stroke:"gray",markerEnd:"inheritance-marker"})}function Nt(t,e){return Tt(t,e,{stroke:"black",markerEnd:"realization-marker","stroke-dasharray":"5,10,5"})}function Bt(t,e){return Tt(t,e,{stroke:"black",markerEnd:"dependency-marker","stroke-dasharray":"5,10,5"})}function Rt(t,e){return Tt(t,e,{stroke:"black",markerStart:"aggregation-marker-reversed"})}function Pt(t,e){return Tt(t,e,{stroke:"black",markerStart:"composition-marker-reversed"})}function Tt(t,e,n){return kt(t,e.waypoints,n)}var At=[{name:"association-marker",element:Et("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"inheritance-marker",element:Et("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"realization-marker",element:Et("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"dependency-marker",element:Et("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"aggregation-marker",element:Et("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"white",transform:"rotate(180,5,5)"})},{name:"composition-marker",element:Et("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"black",transform:"rotate(180,5,5)"})}];function Dt(t,e,n,r){var i,o=ct("marker");W(o,n),J(o,{id:e,viewBox:"0 0 10 10",refX:(i=r,i?0:10),refY:5,markerWidth:5,markerHeight:5,orient:"auto"}),W(t,o)}var Vt,zt=(function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}(Vt={exports:{}},Vt.exports),Vt.exports);function Gt(t,e,n){var r,i;Y.call(this,t),this.textRenderer=n,this.drawShapeHandlers={class:Mt,label:St},this.drawConnectionHandlers={association:Ot,inheritance:Lt,realization:Nt,dependency:Bt,aggregation:Rt,composition:Pt},(i=g("defs",(r=e)._svg))||(i=ct("defs"),W(r._svg,i)),At.forEach(function(t){var e=t.element.cloneNode(!0);Dt(i,t.name,t.element,!1),Dt(i,t.name+"-reversed",e,!0)})}function $t(){this._style={fontFamily:"DroidSansMono",fontSize:12}}zt(Gt,Y),Gt.$inject=["eventBus","canvas","textRenderer"],Gt.prototype.canRender=function(t){return!0},Gt.prototype.drawShape=function(t,e){var n=e.shapeType;return(0,this.drawShapeHandlers[n])(t,e,this.textRenderer)},Gt.prototype.drawConnection=function(t,e){var n=e.connectionType;return(0,this.drawConnectionHandlers[n])(t,e)},Gt.prototype.getShapePath=function(t){return n=(e=t).x,r=e.y,i=e.width,wt([["M",n,r],["l",i,0],["l",0,e.height],["l",-i,0],["z"]]);var e,n,r,i},$t.prototype.createText=function(t,e){var n=ct("text");return J(n,e=R(e,this._style)),mt(n,t),n},$t.prototype.getDimensions=function(t,e){var n,r=ct("text");J(r,this._style),W(document.getElementById("helper-svg")||(J(n=ct("svg"),{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(n),n),r),r.textContent=t;var i=r.getBBox();return it(r),i},$t.prototype.getWidth=function(t,e){return this.getDimensions(t,e).width},$t.prototype.getHeight=function(t,e){return this.getDimensions(t,e).height};var Ft={__init__:["umlRenderer"],umlRenderer:["type",Gt],textRenderer:["type",$t]};function It(t,e,n,r){if(void 0===r&&(r=5),!t||!e||!n)return!1;var i,o,a=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),s=(o=e,(i=t)&&o?Math.sqrt(Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2)):-1);return Math.abs(a/s)<=r}
/**
   * This file contains portions that got extraced from Snap.svg (licensed Apache-2.0).
   *
   * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js
   */Math.PI;function Ht(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function Yt(t,e,n){var r;r=n=n||0,"[object Object]"!==x.call(r)&&(n={x:n,y:n});var i=Ht(t),o=Ht(e),a=i.bottom+n.y<=o.top,s=i.left-n.x>=o.right,c=i.top-n.y>=o.bottom,h=a?"top":c?"bottom":null,u=i.right+n.x<=o.left?"left":s?"right":null;return u&&h?h+"-"+u:u||h||"intersect"}var qt=20,Wt=5,Zt=Math.round;function Xt(t,e,n){var r,i,o,a,s=Yt(e,t,Wt),c=n.split(":")[0],h=Zt((e.x-t.x)/2+t.x),u=Zt((e.y-t.y)/2+t.y),l=(o=s,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[c].test(o)),f=/h|r|l/.test(c),p=!1;return l?(r=f?{x:h,y:t.y}:{x:t.x,y:u},i=f?"h:h":"v:v"):(a=s,i=f?"h:v":"v:h",r=!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[c].test(a)?f?(p=u===t.y,{x:t.x+qt*(/l/.test(c)?-1:1),y:p?u+qt:u}):{x:(p=h===t.x)?h+qt:h,y:t.y+qt*(/t/.test(c)?-1:1)}:{x:h,y:u}),{waypoints:Jt(t,r,i).concat(r),directions:i,turnNextDirections:p}}function Kt(t){return t.split(":").reverse().join(":")}function Jt(t,e,n){if(!(r=n=n||"h:h")||!/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(r))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");var r,i,o;if((o=n)&&/t|r|b|l/.test(o)){var a=Xt(t,e,n),s={waypoints:(i=Xt(e,t,Kt(n))).waypoints.slice().reverse(),directions:Kt(i.directions),turnNextDirections:i.turnNextDirections},c=function(t,e){var n=t.directions.split(":")[1],r=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(r="h"==r?"v":"h");var i=n+":"+r;return{waypoints:Jt(t.waypoints[t.waypoints.length-1],e.waypoints[0],i),directions:i}}(a,s);return[].concat(a.waypoints,c.waypoints,s.waypoints)}return function(t,e,n){var r=Zt((e.x-t.x)/2+t.x),i=Zt((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:r,y:t.y},{x:r,y:e.y}];if("v:v"===n)return[{x:t.x,y:i},{x:e.x,y:i}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function Ut(r){return r.reduce(function(t,e,n){return It(t[t.length-1],r[n+1],e,0)||t.push(e),t},[])}function Qt(t,e,n,r,i,o){this.textRenderer=n,this.elementFactory=t,this.canvas=e,this.modeling=r,this.layouter=i,this.commandStack=o}function te(t,e,n){t in e&&(n[t]=e[t])}function ee(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}Qt.$inject=["elementFactory","canvas","textRenderer","modeling","layouter","commandStack"],Qt.prototype.import=function(t){this.textRenderer;var e=this.elementFactory,n=this.canvas,r=this.modeling,i=(this.layouter,this.commandStack,e.createRoot());n.setRootElement(i);var o,a,s,c,f,p,d,h=(o=t.graph.nodes,a=i,s=r,new Map(o.map(function(t){t.businessObject;var e,n,r,i=t.id;return[i,(e=a,n=t,r=s,delete n.id,r.createClass(n,e))]})));c=t.graph.edges,f=h,p=i,d=r,c.forEach(function(t){var e,n,r,i,o,a,s,c,h,u,l={connectionType:t.type,waypoints:(r=t,i=f,o="waypoints"in r?Ut(r.waypoints):(a=ee(i.get(r.source)),s=ee(i.get(r.target)),(h=Jt(a,s,c)).unshift(a),h.push(s),Ut(h)),(u=o).forEach(function(t){t.x=Math.round(t.x),t.y=Math.round(t.y)}),u)};R(l,(te("sourceName",e=t,n={}),te("targetName",e,n),te("sourceCardinality",e,n),te("targetCardinality",e,n),n)),d.createConnection(f.get(t.source),f.get(t.target),l,p)})};var ne={__depends__:[Ft,{umlImporter:["type",Qt]}]},re=/^class /;function ie(t){return"[object Array]"===Object.prototype.toString.call(t)}function oe(){var t=Array.prototype.slice.call(arguments);1===t.length&&ie(t[0])&&(t=t[0]);var e=t.pop();return e.$inject=t,e}var ae=/constructor\s*[^(]*\(\s*([^)]*)\)/m,se=/^function\s*[^(]*\(\s*([^)]*)\)/m,ce=/\/\*([^*]*)\*\//m;function he(t){if("function"!=typeof t)throw new Error('Cannot annotate "'+t+'". Expected a function!');var e,n=t.toString().match((e=t,re.test(e.toString())?ae:se));return n&&n[1]&&n[1].split(",").map(function(t){return(n=t.match(ce))?n[1].trim():t.trim()})||[]}var ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function le(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function fe(t,o){o=o||{get:function(t,e){if(a.push(t),!1===e)return null;throw c('No provider for "'+t+'"!')}};var a=[],f=this._providers=Object.create(o._providers||null),s=this._instances=Object.create(null),p=s.injector=this,c=function(t){var e=a.join(" -> ");return a.length=0,new Error(e?t+" (Resolving: "+e+")":t)},n=function t(e,n){if(!f[e]&&-1!==e.indexOf(".")){for(var r=e.split("."),i=t(r.shift());r.length;)i=i[r.shift()];return i}if(pe(s,e))return s[e];if(pe(f,e)){if(-1!==a.indexOf(e))throw a.push(e),c("Cannot resolve circular dependency!");return a.push(e),s[e]=f[e][0](f[e][1]),a.pop(),s[e]}return o.get(e,n)},h=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("function"!=typeof t){if(!ie(t))throw new Error('Cannot invoke "'+t+'". Expected a function!');t=oe(t.slice())}return{fn:t,dependencies:(t.$inject||he(t)).map(function(t){return pe(e,t)?e[t]:n(t)})}},e=function(t){var e=h(t),n=e.dependencies,r=e.fn;return new(Function.prototype.bind.apply(r,[null].concat(le(n))))},r=function(t,e,n){var r=h(t,n),i=r.dependencies,o=r.fn;return o.call.apply(o,[e].concat(le(i)))},d=function(e){return oe(function(t){return e.get(t)})},u={factory:r,type:e,value:function(t){return t}};t.forEach(function(r){function i(t,e){return"value"!==t&&ie(e)&&(e=oe(e.slice())),e}if(r instanceof function(){var n=[];this.factory=function(t,e){return n.push([t,"factory",e]),this},this.value=function(t,e){return n.push([t,"value",e]),this},this.type=function(t,e){return n.push([t,"type",e]),this},this.forEach=function(t){n.forEach(t)}})r.forEach(function(t){var e=t[0],n=t[1],r=t[2];f[e]=[u[n],i(n,r),n]});else if("object"===(void 0===r?"undefined":ue(r)))if(r.__exports__){var t=Object.keys(r).reduce(function(t,e){return"__"!==e.substring(0,2)&&(t[e]=r[e]),t},Object.create(null)),e=new fe((r.__modules__||[]).concat([t]),p),n=oe(function(t){return e.get(t)});r.__exports__.forEach(function(t){f[t]=[n,t,"private",e]})}else Object.keys(r).forEach(function(t){if("private"!==r[t][2]){var e=r[t][0],n=r[t][1];f[t]=[u[e],i(e,n),e]}else f[t]=r[t]})}),this.get=n,this.invoke=r,this.instantiate=e,this.createChild=function(t,e){if(e&&e.length){var n,r,i,o,a=Object.create(null),s=Object.create(null),c=[],h=[],u=[];for(var l in f)n=f[l],-1!==e.indexOf(l)&&("private"===n[2]?(r=c.indexOf(n[3]),a[l]=-1===r?(i=n[3].createChild([],e),o=d(i),c.push(n[3]),h.push(i),u.push(o),[o,l,"private",i]):[u[r],l,"private",h[r]]):a[l]=[n[2],n[1]],s[l]=!0),"factory"!==n[2]&&"type"!==n[2]||!n[1].$scope||e.forEach(function(t){-1!==n[1].$scope.indexOf(t)&&(a[l]=[n[2],n[1]],s[t]=!0)});e.forEach(function(t){if(!s[t])throw new Error('No provider for "'+t+'". Cannot use provider from the parent!')}),t.unshift(a)}return new fe(t,p)}}function pe(t,e){return Object.hasOwnProperty.call(t,e)}function de(t,e){Y.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2})}zt(de,Y),de.prototype.canRender=function(){return!0},de.prototype.drawShape=function(t,e){var n=ct("rect");return J(n,{x:0,y:0,width:e.width||0,height:e.height||0}),J(n,this.SHAPE_STYLE),W(t,n),n},de.prototype.drawConnection=function(t,e){var n,r,i,o=(n=e.waypoints,r=this.CONNECTION_STYLE,J(i=ct("polyline"),{points:function(t){for(var e,n="",r=0;e=t[r];r++)n+=e.x+","+e.y+" ";return n}(n)}),r&&J(i,r),i);return W(t,o),o},de.prototype.getShapePath=function(t){var e=t.x,n=t.y,r=t.width;return wt([["M",e,n],["l",r,0],["l",0,t.height],["l",-r,0],["z"]])},de.prototype.getConnectionPath=function(t){var e,n,r=t.waypoints,i=[];for(e=0;n=r[e];e++)n=n.original||n,i.push([0===e?"M":"L",n.x,n.y]);return wt(i)},de.$inject=["eventBus","styles"];var ye={__init__:["defaultRenderer"],defaultRenderer:["type",de],styles:["type",function(){var r={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},i=this;this.cls=function(t,e,n){return R(this.style(e,n),{class:t})},this.style=function(t,e){E(t)||e||(e=t,t=[]);var n=S(t,function(t,e){return R(t,r[e]||{})},{});return e?R(n,e):n},this.computeStyle=function(t,e,n){return E(e)||(n=e,e=[]),i.style(e||[],R({},n,t||{}))}}]};function ve(t,e){return Math.round(t*e)/e}function me(t){return C(t)?t+"px":t}function ge(t,e,n){var r=ct("g");nt(r).add(e);var i=void 0!==n?n:t.childNodes.length-1;return t.insertBefore(r,t.childNodes[i]||null),r}var _e={shape:["x","y","width","height"],connection:["waypoints"]};function we(t,e,n,r){this._eventBus=e,this._elementRegistry=r,this._graphicsFactory=n,this._init(t||{})}function be(t,e){var n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}we.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],we.prototype._init=function(t){var e,n,r,i=this._eventBus,o=this._container=(n=(e=R({},{width:"100%",height:"100%"},e=t)).container||document.body,(r=document.createElement("div")).setAttribute("class","djs-container"),R(r.style,{position:"relative",overflow:"hidden",width:me(e.width),height:me(e.height)}),n.appendChild(r),r),a=this._svg=ct("svg");J(a,{width:"100%",height:"100%"}),W(o,a);var s=this._viewport=ge(a,"viewport");!(this._layers={})!==t.deferUpdate&&(this._viewboxChanged=function(n,r){var i,o,a,s;function e(){var t=Date.now(),e=s+r-t;if(0<e)return c(e);n.apply(a,o),i=s=o=a=void 0}function c(t){i=setTimeout(e,t)}return function(){s=Date.now();for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];o=e,a=this,i||c(r)}}(N(this._viewboxChanged,this),300)),i.on("diagram.init",function(){i.fire("canvas.init",{svg:a,viewport:s})},this),i.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed"],function(){delete this._cachedViewbox},this),i.on("diagram.destroy",500,this._destroy,this),i.on("diagram.clear",500,this._clear,this)},we.prototype._destroy=function(t){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});var e=this._container.parentNode;e&&e.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._rootElement,delete this._viewport},we.prototype._clear=function(){var r=this;this._elementRegistry.getAll().forEach(function(t){var e,n="waypoints"in(e=t)?"connection":"x"in e?"shape":"root";"root"===n?r.setRootElement(null,!0):r._removeElement(t,n)}),delete this._cachedViewbox},we.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},we.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");var n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},we.prototype._createLayer=function(t,n){n||(n=0);var e=S(this._layers,function(t,e){return n>=e.index&&t++,t},0);return{group:ge(this._viewport,"layer-"+t,e),index:n}},we.prototype.getContainer=function(){return this._container},we.prototype._updateMarker=function(t,e,n){var r;t.id||(t=this._elementRegistry.get(t)),(r=this._elementRegistry._elements[t.id])&&(M([r.gfx,r.secondaryGfx],function(t){t&&(n?nt(t).add(e):nt(t).remove(e))}),this._eventBus.fire("element.marker.update",{element:t,gfx:r.gfx,marker:e,add:!!n}))},we.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},we.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},we.prototype.hasMarker=function(t,e){return t.id||(t=this._elementRegistry.get(t)),nt(this.getGraphics(t)).has(e)},we.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},we.prototype.getRootElement=function(){return this._rootElement||this.setRootElement({id:"__implicitroot",children:[]}),this._rootElement},we.prototype.setRootElement=function(t,e){t&&this._ensureValid("root",t);var n=this._rootElement,r=this._elementRegistry,i=this._eventBus;if(n){if(!e)throw new Error("rootElement already set, need to specify override");i.fire("root.remove",{element:n}),i.fire("root.removed",{element:n}),r.remove(n)}if(t){var o=this.getDefaultLayer();i.fire("root.add",{element:t}),r.add(t,o,this._svg),i.fire("root.added",{element:t,gfx:o})}return this._rootElement=t},we.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element with id "+e.id+" already exists");var r,n=_e[t];if(!(r=function(t){return void 0!==e[t]},S(n,function(t,e,n){return t&&r(e,n)},!0)))throw new Error("must supply { "+n.join(", ")+" } with "+t)},we.prototype._setParent=function(t,e,n){!function(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var r=t.indexOf(e);if(-1!==r){if(r===n)return;if(-1===n)return;t.splice(r,1)}-1!==n?t.splice(n,0,e):t.push(e)}}(e.children,t,n),t.parent=e},we.prototype._addElement=function(t,e,n,r){n=n||this.getRootElement();var i=this._eventBus,o=this._graphicsFactory;this._ensureValid(t,e),i.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,r);var a=o.create(t,e,r);return this._elementRegistry.add(e,a),o.update(t,e,a),i.fire(t+".added",{element:e,gfx:a}),e},we.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},we.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},we.prototype._removeElement=function(t,e){var n=this._elementRegistry,r=this._graphicsFactory,i=this._eventBus;if(t=n.get(t.id||t))return i.fire(e+".remove",{element:t}),r.remove(t),function(t,e){if(!t||!e)return;var n=t.indexOf(e);-1!==n&&t.splice(n,1)}(t.parent&&t.parent.children,t),t.parent=null,i.fire(e+".removed",{element:t}),n.remove(t),t},we.prototype.removeShape=function(t){return this._removeElement(t,"shape")},we.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},we.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},we.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},we.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},we.prototype.viewbox=function(e){if(void 0===e&&this._cachedViewbox)return this._cachedViewbox;var t,n,r,i,o,a,s=this._viewport,c=this.getSize();return e?(this._changeViewbox(function(){i=Math.min(c.width/e.width,c.height/e.height);var t=this._svg.createSVGMatrix().scale(i).translate(-e.x,-e.y);gt(s,t)}),e):(t=this.getDefaultLayer().getBBox(),n=(r=gt(s))?r.matrix:function(t,e,n,r,i,o){var a=ht.createSVGMatrix();switch(arguments.length){case 0:return a;case 1:return ut(a,t);case 6:return ut(a,{a:t,b:e,c:n,d:r,e:i,f:o})}}(),i=ve(n.a,1e3),o=ve(-n.e||0,1e3),a=ve(-n.f||0,1e3),e=this._cachedViewbox={x:o?o/i:0,y:a?a/i:0,width:c.width/i,height:c.height/i,scale:i,inner:{width:t.width,height:t.height,x:t.x,y:t.y},outer:c})},we.prototype.scroll=function(t){var e=this._viewport,n=e.getCTM();return t&&this._changeViewbox(function(){t=R({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),be(e,n)}),{x:n.e,y:n.f}},we.prototype.zoom=function(t,e){return t?"fit-viewport"===t?this._fitViewport(e):(this._changeViewbox(function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),r=this._setZoom(t,e)}),ve(r.a,1e3)):this.viewbox(t).scale;var n,r},we.prototype._fitViewport=function(t){var e,n,r=this.viewbox(),i=r.outer,o=r.inner;return n=0<=o.x&&0<=o.y&&o.x+o.width<=i.width&&o.y+o.height<=i.height&&!t?{x:0,y:0,width:Math.max(o.width+o.x,i.width),height:Math.max(o.height+o.y,i.height)}:(e=Math.min(1,i.width/o.width,i.height/o.height),{x:o.x+(t?o.width/2-i.width/e/2:0),y:o.y+(t?o.height/2-i.height/e/2:0),width:i.width/e,height:i.height/e}),this.viewbox(n),this.viewbox(!1).scale},we.prototype._setZoom=function(t,e){var n,r,i,o,a=this._svg,s=this._viewport,c=a.createSVGMatrix(),h=a.createSVGPoint(),u=(r=s.getCTM()).a;return o=e?(n=R(h,e).matrixTransform(r.inverse()),i=c.translate(n.x,n.y).scale(1/u*t).translate(-n.x,-n.y),r.multiply(i)):c.scale(t),be(this._viewport,o),o},we.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},we.prototype.getAbsoluteBBox=function(t){var e,n=this.viewbox();t.waypoints?e=this.getGraphics(t).getBBox():e=t;return{x:e.x*n.scale-n.x*n.scale,y:e.y*n.scale-n.y*n.scale,width:e.width*n.scale,height:e.height*n.scale}},we.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var xe="data-element-id";function ke(t){this._elements={},this._eventBus=t}ke.$inject=["eventBus"],ke.prototype.add=function(t,e,n){var r=t.id;this._validateId(r),J(e,xe,r),n&&J(n,xe,r),this._elements[r]={element:t,gfx:e,secondaryGfx:n}},ke.prototype.remove=function(t){var e=this._elements,n=t.id||t,r=n&&e[n];r&&(J(r.gfx,xe,""),r.secondaryGfx&&J(r.secondaryGfx,xe,""),delete e[n])},ke.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),r=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,r)},ke.prototype.get=function(t){var e;e="string"==typeof t?t:t&&J(t,xe);var n=this._elements[e];return n&&n.element},ke.prototype.filter=function(n){var r=[];return this.forEach(function(t,e){n(t,e)&&r.push(t)}),r},ke.prototype.getAll=function(){return this.filter(function(t){return t})},ke.prototype.forEach=function(i){var o=this._elements;Object.keys(o).forEach(function(t){var e=o[t],n=e.element,r=e.gfx;return i(n,r)})},ke.prototype.getGraphics=function(t,e){var n=t.id||t,r=this._elements[n];return r&&(e?r.secondaryGfx:r.gfx)},ke.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var Ee={extend:function(t,r,e,i){var o=e.inverse;return Object.defineProperty(t,"remove",{value:function(t){var e=this.indexOf(t);return-1!==e&&(this.splice(e,1),r.unset(t,o,i)),t}}),Object.defineProperty(t,"contains",{value:function(t){return-1!==this.indexOf(t)}}),Object.defineProperty(t,"add",{value:function(t,e){var n=this.indexOf(t);if(void 0===e){if(-1!==n)return;e=this.length}-1!==n&&this.splice(n,1),this.splice(e,0,t),-1===n&&r.set(t,o,i)}}),Object.defineProperty(t,"__refs_collection",{value:!0}),t},isExtended:function(t){return!0===t.__refs_collection}};function Ce(e,n,r){var t=Ee.extend(r[n.name]||[],e,n,r);Object.defineProperty(r,n.name,{enumerable:n.enumerable,value:t}),t.length&&t.forEach(function(t){e.set(t,n.inverse,r)})}function je(t,e){if(!(this instanceof je))return new je(t,e);(t.inverse=e).inverse=t,this.props={},this.props[t.name]=t,this.props[e.name]=e}je.prototype.bind=function(t,e){if("string"==typeof e){if(!this.props[e])throw new Error("no property <"+e+"> in ref");e=this.props[e]}var n,r,i,o,a;e.collection?Ce(this,e,t):(n=this,i=t,o=(r=e).inverse,a=i[r.name],Object.defineProperty(i,r.name,{configurable:r.configurable,enumerable:r.enumerable,get:function(){return a},set:function(t){if(t!==a){var e=a;a=null,e&&n.unset(e,o,i),a=t,n.set(a,o,i)}}}))},je.prototype.ensureRefsCollection=function(t,e){var n=t[e.name];return Ee.isExtended(n)||Ce(this,e,t),n},je.prototype.ensureBound=function(t,e){var n,r;n=t,r=e,Object.prototype.hasOwnProperty.call(n,r.name||r)||this.bind(t,e)},je.prototype.unset=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).remove(n):t[e.name]=void 0)},je.prototype.set=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).add(n):t[e.name]=n)};var Me=je,Se=Ee;Me.Collection=Se;var Oe=new Me({name:"children",enumerable:!0,collection:!0},{name:"parent"}),Le=new Me({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),Ne=new Me({name:"attachers",collection:!0},{name:"host"}),Be=new Me({name:"outgoing",collection:!0},{name:"source"}),Re=new Me({name:"incoming",collection:!0},{name:"target"});function Pe(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),Oe.bind(this,"parent"),Le.bind(this,"labels"),Be.bind(this,"outgoing"),Re.bind(this,"incoming")}function Te(){Pe.call(this),Oe.bind(this,"children"),Ne.bind(this,"host"),Ne.bind(this,"attachers")}function Ae(){Te.call(this)}function De(){Te.call(this),Le.bind(this,"labelTarget")}function Ve(){Pe.call(this),Be.bind(this,"source"),Re.bind(this,"target")}zt(Te,Pe),zt(Ae,Te),zt(De,Te),zt(Ve,Pe);var ze={connection:Ve,shape:Te,label:De,root:Ae};function Ge(){this._uid=12}Ge.prototype.createRoot=function(t){return this.create("root",t)},Ge.prototype.createLabel=function(t){return this.create("label",t)},Ge.prototype.createShape=function(t){return this.create("shape",t)},Ge.prototype.createConnection=function(t){return this.create("connection",t)},Ge.prototype.create=function(t,e){return(e=R({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=ze[t];if(!n)throw new Error("unknown type: <"+t+">");return R(new n,e)}(t,e)};var $e="__fn",Fe=Array.prototype.slice;function Ie(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function He(){}function Ye(t,e,n){var r,i=r?ht.createSVGTransformFromMatrix(r):ht.createSVGTransform();i.setTranslate(e,n),gt(t,i)}function qe(t,e){this._eventBus=t,this._elementRegistry=e}function We(t,e,n){e.insertBefore(t,n||e.firstChild)}Ie.prototype.on=function(t,e,n,r){if(t=E(t)?t:[t],j(e)&&(r=n,n=e,e=1e3),!C(e))throw new Error("priority must be a number");var i=n;r&&((i=N(n,r))[$e]=n[$e]||n);var o=this;t.forEach(function(t){o._addListener(t,{priority:e,callback:i,next:null})})},Ie.prototype.once=function(e,t,n,r){var i=this;if(j(t)&&(r=n,n=t,t=1e3),!C(t))throw new Error("priority must be a number");function o(){var t=n.apply(r,arguments);return i.off(e,o),t}o[$e]=n,this.on(e,t,o)},Ie.prototype.off=function(t,e){t=E(t)?t:[t];var n=this;t.forEach(function(t){n._removeListener(t,e)})},Ie.prototype.createEvent=function(t){var e=new He;return e.init(t),e},Ie.prototype.fire=function(t,e){var n,r,i,o;if(o=Fe.call(arguments),"object"==typeof t&&(t=(n=t).type),!t)throw new Error("no event type specified");if(r=this._listeners[t]){n=e instanceof He?e:this.createEvent(e);var a=(o[0]=n).type;t!==a&&(n.type=t);try{i=this._invokeListeners(n,o,r)}finally{t!==a&&(n.type=a)}return void 0===i&&n.defaultPrevented&&(i=!1),i}},Ie.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},Ie.prototype._destroy=function(){this._listeners={}},Ie.prototype._invokeListeners=function(t,e,n){for(var r;n&&!t.cancelBubble;)r=this._invokeListener(t,e,n),n=n.next;return r},Ie.prototype._invokeListener=function(t,e,n){var r,i,o;try{i=n.callback,o=e,void 0!==(r=i.apply(null,o))&&(t.returnValue=r,t.stopPropagation()),!1===r&&t.preventDefault()}catch(t){if(!this.handleError(t))throw console.error("unhandled error in event listener"),console.error(t.stack),t}return r},Ie.prototype._addListener=function(t,e){var n,r=this._getListeners(t);if(r){for(;r;){if(r.priority<e.priority)return e.next=r,void(n?n.next=e:this._setListeners(t,e));r=(n=r).next}n.next=e}else this._setListeners(t,e)},Ie.prototype._getListeners=function(t){return this._listeners[t]},Ie.prototype._setListeners=function(t,e){this._listeners[t]=e},Ie.prototype._removeListener=function(t,e){var n,r,i,o=this._getListeners(t);if(e)for(;o;)n=o.next,(i=o.callback)!==e&&i[$e]!==e||(r?r.next=n:this._setListeners(t,n)),r=o,o=n;else this._setListeners(t,null)},He.prototype.stopPropagation=function(){this.cancelBubble=!0},He.prototype.preventDefault=function(){this.defaultPrevented=!0},He.prototype.init=function(t){R(this,t||{})},qe.$inject=["eventBus","elementRegistry"],qe.prototype._getChildren=function(t){var e,n=this._elementRegistry.getGraphics(t);return t.parent?(e=n.parentNode.childNodes[1])||(nt(e=ct("g")).add("djs-children"),W(n.parentNode,e)):e=n,e},qe.prototype._clear=function(t){var e=g(".djs-visual",t);return function(t){for(var e;t.childNodes.length;)e=t.childNodes[0],t.removeChild(e)}(e),e},qe.prototype._createContainer=function(t,e,n){var r=ct("g");nt(r).add("djs-group"),void 0!==n?We(r,e,e.childNodes[n]):W(e,r);var i=ct("g");nt(i).add("djs-element"),nt(i).add("djs-"+t),W(r,i);var o=ct("g");return nt(o).add("djs-visual"),W(i,o),i},qe.prototype.create=function(t,e,n){var r=this._getChildren(e.parent);return this._createContainer(t,r,n)},qe.prototype.updateContainments=function(t){var r=this,i=this._elementRegistry;M(S(t,function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t},{}),function(t){var e=t.children;if(e){var n=r._getChildren(t);M(e.slice().reverse(),function(t){We(i.getGraphics(t).parentNode,n)})}})},qe.prototype.drawShape=function(t,e){return this._eventBus.fire("render.shape",{gfx:t,element:e})},qe.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},qe.prototype.drawConnection=function(t,e){return this._eventBus.fire("render.connection",{gfx:t,element:e})},qe.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},qe.prototype.update=function(t,e,n){if(e.parent){var r=this._clear(n);if("shape"===t)this.drawShape(r,e),Ye(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(r,e)}e.hidden?J(n,"display","none"):J(n,"display","block")}},qe.prototype.remove=function(t){it(this._elementRegistry.getGraphics(t).parentNode)};var Ze={__depends__:[ye],__init__:["canvas"],canvas:["type",we],elementRegistry:["type",ke],elementFactory:["type",Ge],eventBus:["type",Ie],graphicsFactory:["type",qe]};function Xe(t){var r=[],i=[];function o(t){return 0<=r.indexOf(t)}t.forEach(function t(e){var n;o(e)||((e.__depends__||[]).forEach(t),o(e)||(n=e,r.push(n),(e.__init__||[]).forEach(function(t){i.push(t)})))});var e=new fe(r);return i.forEach(function(t){try{e["string"==typeof t?"get":"invoke"](t)}catch(t){throw console.error("Failed to instantiate component"),console.error(t.stack),t}}),e}function Ke(t,e){var n;this.injector=e=e||Xe([{config:["value",n=(n=t)||{}]},Ze].concat(n.modules||[])),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}function Je(t){this._container=this._createContainer(t),this._init(this._container,t)}return Ke.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},Ke.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},zt(Je,Ke),Je.prototype._modules=[].concat(Je.prototype._coreModules=[ne],Je.prototype._viewModules=[D,I]),Je.prototype.importJSON=function(t){this.get("umlImporter").import(t)},Je.prototype._createContainer=function(t){var e;return R((e=d("containerID"in t?'<div id="'+t.containerID+'"class="umljs-container"></div>':'<div class="umljs-container"></div>')).style,{width:"100%",height:"100%",position:"relative"}),e},Je.prototype._init=function(t,e){var n={canvas:{container:t},modules:this._modules};Ke.call(this,n),e&&e.parent&&this.attachTo(e.parent)},Je.prototype.attachTo=function(t){if(!t)throw new Error("parentNode required");this.detach(),t.get&&t.constructor.prototype.jquery&&(t=t.get(0)),"string"==typeof t&&(t=g(t)),t.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},Je.prototype.detach=function(){var t=this._container,e=t.parentNode;e&&(this._emit("detach",{}),e.removeChild(t))},Je.prototype._emit=function(t,e){return this.get("eventBus").fire(t,e)},Je});
